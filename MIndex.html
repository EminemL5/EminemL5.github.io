<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo Menú Digital Mejorado</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f39c12;
            --background-color: #f4f4f4;
            --text-color: #333;
            --white: #ffffff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
        }

        header, footer {
            background-color: var(--primary-color);
            color: var(--white);
            text-align: center;
            padding: 1rem;
        }

        main {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        h1, h2, h3 {
            margin-bottom: 1rem;
        }

        form, #inicio, #catalogo-menu, .producto, #categorias, #cupones, #editar-negocio, #inventario, #registro-movimientos {
            background-color: var(--white);
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        form:hover, .producto:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        button, .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover, .button:hover {
            opacity: 0.9;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--white);
        }

        .btn-danger {
            background-color: #e74c3c;
            color: var(--white);
        }

        .btn-icon {
            margin-right: 0.5rem;
        }

        .hidden {
            display: none;
        }

        #productos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem;
        }

        .producto {
            position: relative;
            overflow: hidden;
        }

        .producto-acciones {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            gap: 0.5rem;
        }

        .producto-acciones button {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }

        .imagen-producto {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }

        .carrusel {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
        }

        .carrusel-inner {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }

        .carrusel-item {
            min-width: 100%;
            transition: opacity 0.5s ease-in-out;
        }

        .carrusel-control {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            font-size: 1.5rem;
            transition: background-color 0.3s ease;
        }

        .carrusel-control:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }

        .carrusel-control.prev {
            left: 10px;
        }

        .carrusel-control.next {
            right: 10px;
        }

        #imagenes-botones {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }

        #imagenes-botones button {
            flex: 1;
            min-width: 100px;
        }

        #categorias-lista, #cupones-lista {
            list-style-type: none;
            padding: 0;
        }

        #categorias-lista li, #cupones-lista li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #ddd;
        }

        #toggle-catalogo {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .abierto {
            background-color: #2ecc71;
            color: white;
        }

        .cerrado {
            background-color: #e74c3c;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 0.5rem;
            text-align: left;
        }

        th {
            background-color: var(--primary-color);
            color: var(--white);
        }

        #notificaciones {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .notificacion {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
    </style>
</head>
<body>
    <header>
        <h1 class="text-3xl font-bold">Catálogo Menú Digital Mejorado</h1>
    </header>

    <main>
        <section id="inicio" class="fade-in">
            <h2 class="text-2xl font-semibold mb-4">Bienvenido a Catálogo Menú Digital</h2>
            <p class="mb-4">Crea y gestiona tu menú digital de forma fácil y rápida.</p>
            <div class="flex justify-between">
                <button id="btn-mostrar-registro" class="btn-primary">
                    <i class="fas fa-user-plus btn-icon"></i>Registrar Negocio
                </button>
                <button id="btn-mostrar-login" class="btn-secondary">
                    <i class="fas fa-sign-in-alt btn-icon"></i>Iniciar Sesión
                </button>
            </div>
        </section>

        <section id="registro-negocio" class="hidden fade-in">
            <h2 class="text-2xl font-semibold mb-4">Registro de Negocio</h2>
            <form id="form-registro">
                <label for="reg-nombre-negocio">Nombre del Negocio:</label>
                <input type="text" id="reg-nombre-negocio" required>

                <label for="telefono">Número de Teléfono:</label>
                <input type="tel" id="telefono" required>

                <label for="direccion">Dirección:</label>
                <input type="text" id="direccion" required>

                <label for="pais">País:</label>
                <input type="text" id="pais" required>

                <label for="reg-contrasena">Contraseña:</label>
                <input type="password" id="reg-contrasena" required>

                <label for="logo">Logotipo del Negocio:</label>
                <input type="file" id="logo" accept="image/*">

                <button type="submit" class="btn-primary">
                    <i class="fas fa-save btn-icon"></i>Registrar Negocio
                </button>
            </form>
        </section>

        <section id="login" class="hidden fade-in">
            <h2 class="text-2xl font-semibold mb-4">Iniciar Sesión</h2>
            <form id="form-login">
                <label for="login-nombre-negocio">Nombre del Negocio:</label>
                <input type="text" id="login-nombre-negocio" required>

                <label for="login-contrasena">Contraseña:</label>
                <input type="password" id="login-contrasena" required>

                <button type="submit" class="btn-primary">
                    <i class="fas fa-sign-in-alt btn-icon"></i>Iniciar Sesión
                </button>
            </form>
        </section>

        <section id="catalogo-menu" class="hidden fade-in">
            <h2 class="text-2xl font-semibold mb-4">Catálogo Menú</h2>
            <div id="info-negocio"></div>
            <div class="flex flex-wrap gap-4 mb-4">
                <button id="editar-info-negocio" class="btn-secondary">
                    <i class="fas fa-edit btn-icon"></i>Editar Información
                </button>
                <button id="agregar-producto" class="btn-primary">
                    <i class="fas fa-plus btn-icon"></i>Agregar Producto
                </button>
                <button id="gestionar-categorias" class="btn-secondary">
                    <i class="fas fa-tags btn-icon"></i>Categorías
                </button>
                <button id="gestionar-cupones" class="btn-secondary">
                    <i class="fas fa-ticket-alt btn-icon"></i>Cupones
                </button>
                <button id="gestionar-inventario" class="btn-secondary">
                    <i class="fas fa-boxes btn-icon"></i>Inventario
                </button>
            </div>
            <div id="aplicar-cupon" class="mb-4">
                <input type="text" id="cupon-input" placeholder="Ingrese código de cupón" class="flex-grow">
                <button id="btn-aplicar-cupon" class="btn-primary">
                    <i class="fas fa-check btn-icon"></i>Aplicar Cupón
                </button>
            </div>
            <div id="productos"></div>
            <div class="flex justify-center items-center mt-4">
                <button id="btn-anterior" class="btn-secondary mr-2">
                    <i class="fas fa-chevron-left btn-icon"></i>Anterior
                </button>
                <span id="pagina-actual" class="mx-4"></span>
                <button id="btn-siguiente" class="btn-secondary ml-2">
                    <i class="fas fa-chevron-right btn-icon"></i>Siguiente
                </button>
            </div>
            <button id="cerrar-sesion" class="btn-danger mt-4">
                <i class="fas fa-sign-out-alt btn-icon"></i>Cerrar Sesión
            </button>
            <button id="eliminar-cuenta" class="btn-danger mt-4">
                <i class="fas fa-user-times btn-icon"></i>Eliminar Cuenta
            </button>
        </section>

        <section id="form-producto" class="hidden fade-in">
            <h2 class="text-2xl font-semibold mb-4">Agregar/Editar Producto</h2>
            <form id="producto-form">
                <input type="hidden" id="producto-id">
                <label for="producto-nombre">Nombre:</label>
                <input type="text" id="producto-nombre" required>

                <label for="producto-descripcion">Descripción:</label>
                <textarea id="producto-descripcion" required></textarea>

                <label for="producto-precio">Precio:</label>
                
                <input type="number" id="producto-precio" step="0.01" required>

                <label for="producto-moneda">Tipo de Moneda:</label>
                <select id="producto-moneda" required>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                    <option value="GBP">GBP</option>
                    <option value="CUP">CUP</option>
                </select>

                <label for="producto-categoria">Categoría:</label>
                <select id="producto-categoria" required></select>

                <label for="producto-descuento">Descuento (%):</label>
                <input type="number" id="producto-descuento" min="0" max="100" value="0">

                <div id="imagenes-botones"></div>

                <button type="submit" class="btn-primary">
                    <i class="fas fa-save btn-icon"></i>Guardar Producto
                </button>
                <button type="button" id="cancelar-producto" class="btn-secondary">
                    <i class="fas fa-times btn-icon"></i>Cancelar
                </button>
            </form>
        </section>

        <section id="categorias" class="hidden fade-in">
            <h2 class="text-2xl font-semibold mb-4">Gestionar Categorías</h2>
            <form id="categoria-form">
                <label for="categoria-nombre">Nombre de la Categoría:</label>
                <input type="text" id="categoria-nombre" required>
                <button type="submit" class="btn-primary">
                    <i class="fas fa-plus btn-icon"></i>Agregar Categoría
                </button>
            </form>
            <ul id="categorias-lista" class="mt-4"></ul>
            <button id="volver-catalogo" class="btn-secondary mt-4">
                <i class="fas fa-arrow-left btn-icon"></i>Volver al Catálogo
            </button>
        </section>

        <section id="cupones" class="hidden fade-in">
            <h2 class="text-2xl font-semibold mb-4">Gestionar Cupones</h2>
            <form id="cupon-form">
                <label for="cupon-codigo">Código del Cupón:</label>
                <input type="text" id="cupon-codigo" required>
                <label for="cupon-descuento">Descuento (%):</label>
                <input type="number" id="cupon-descuento" min="0" max="100" required>
                <button type="submit" class="btn-primary">
                    <i class="fas fa-plus btn-icon"></i>Agregar Cupón
                </button>
            </form>
            <ul id="cupones-lista" class="mt-4"></ul>
            <button id="volver-catalogo-cupones" class="btn-secondary mt-4">
                <i class="fas fa-arrow-left btn-icon"></i>Volver al Catálogo
            </button>
        </section>

        <section id="editar-negocio" class="hidden fade-in">
            <h2 class="text-2xl font-semibold mb-4">Editar Información del Negocio</h2>
            <form id="form-editar-negocio">
                <label for="edit-nombre-negocio">Nombre del Negocio:</label>
                <input type="text" id="edit-nombre-negocio" required>

                <label for="edit-telefono">Número de Teléfono:</label>
                <input type="tel" id="edit-telefono" required>

                <label for="edit-direccion">Dirección:</label>
                <input type="text" id="edit-direccion" required>

                <label for="edit-pais">País:</label>
                <input type="text" id="edit-pais" required>

                <label for="edit-logo">Logotipo del Negocio:</label>
                <input type="file" id="edit-logo" accept="image/*">

                <button type="submit" class="btn-primary">
                    <i class="fas fa-save btn-icon"></i>Guardar Cambios
                </button>
                <button type="button" id="cancelar-edicion" class="btn-secondary">
                    <i class="fas fa-times btn-icon"></i>Cancelar
                </button>
            </form>
        </section>

        <section id="inventario" class="hidden fade-in">
            <h2 class="text-2xl font-semibold mb-4">Gestionar Inventario</h2>
            <form id="inventario-form">
                <label for="inventario-nombre">Nombre del Producto:</label>
                <input type="text" id="inventario-nombre" required>

                <label for="inventario-cantidad-entrada">Cantidad/Entrada:</label>
                <input type="number" id="inventario-cantidad-entrada" min="0">

                <label for="inventario-cantidad-salida">Cantidad/Salida:</label>
                <input type="number" id="inventario-cantidad-salida" min="0">

                <label for="inventario-precio-inversion">Precio de Inversión:</label>
                <input type="number" id="inventario-precio-inversion" required min="0" step="0.01">

                <label for="inventario-precio-venta">Precio de Venta:</label>
                <input type="number" id="inventario-precio-venta" required min="0" step="0.01">

                <button type="submit" class="btn-primary">
                    <i class="fas fa-plus btn-icon"></i>Agregar/Actualizar Producto
                </button>
            </form>

            <div class="overflow-x-auto mt-4">
                <table id="inventario-tabla" class="w-full">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Total</th>
                            <th>Precio de Inversión</th>
                            <th>Precio de Venta</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="inventario-totales" class="mt-4">
                <p>Inversión Total: <span id="inversion-total">0.00</span></p>
                <p>Precio Total de Venta: <span id="venta-total">0.00</span></p>
                <p>Ganancia Total: <span id="ganancia-total">0.00</span></p>
            </div>

            <button id="volver-catalogo-inventario" class="btn-secondary mt-4">
                <i class="fas fa-arrow-left btn-icon"></i>Volver al Catálogo
            </button>
        </section>

        <section id="registro-movimientos" class="hidden fade-in">
            <h2 class="text-2xl font-semibold mb-4">Registro de Movimientos</h2>
            <div class="overflow-x-auto">
                <table id="movimientos-tabla" class="w-full">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Producto</th>
                            <th>Tipo</th>
                            <th>Cantidad</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <button id="volver-inventario" class="btn-secondary mt-4">
                <i class="fas fa-arrow-left btn-icon"></i>Volver al Inventario
            </button>
        </section>
    </main>

    <footer>
        <p>&copy; 2023 Catálogo Menú Digital Mejorado</p>
    </footer>

    <button id="toggle-catalogo" class="abierto">
        <i class="fas fa-store"></i>
    </button>

    <div id="notificaciones"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/js/all.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const secciones = {
                inicio: document.getElementById('inicio'),
                registro: document.getElementById('registro-negocio'),
                login: document.getElementById('login'),
                catalogo: document.getElementById('catalogo-menu'),
                formProducto: document.getElementById('form-producto'),
                categorias: document.getElementById('categorias'),
                cupones: document.getElementById('cupones'),
                editarNegocio: document.getElementById('editar-negocio'),
                inventario: document.getElementById('inventario'),
                registroMovimientos: document.getElementById('registro-movimientos')
            };

            const formRegistro = document.getElementById('form-registro');
            const formLogin = document.getElementById('form-login');
            const infoNegocio = document.getElementById('info-negocio');
            const productosContainer = document.getElementById('productos');
            const btnAgregarProducto = document.getElementById('agregar-producto');
            const btnCerrarSesion = document.getElementById('cerrar-sesion');
            const formProducto = document.getElementById('producto-form');
            const btnCancelarProducto = document.getElementById('cancelar-producto');
            const imagenesBotones = document.getElementById('imagenes-botones');
            const selectCategoria = document.getElementById('producto-categoria');
            const btnGestionarCategorias = document.getElementById('gestionar-categorias');
            const btnGestionarCupones = document.getElementById('gestionar-cupones');
            const formCategoria = document.getElementById('categoria-form');
            const categoriasLista = document.getElementById('categorias-lista');
            const btnVolverCatalogo = document.getElementById('volver-catalogo');
            const formCupon = document.getElementById('cupon-form');
            const cuponesLista = document.getElementById('cupones-lista');
            const btnVolverCatalogoCupones = document.getElementById('volver-catalogo-cupones');
            const btnToggleCatalogo = document.getElementById('toggle-catalogo');
            const btnAplicarCupon = document.getElementById('btn-aplicar-cupon');
            const cuponInput = document.getElementById('cupon-input');
            const btnAnterior = document.getElementById('btn-anterior');
            const btnSiguiente = document.getElementById('btn-siguiente');
            const paginaActual = document.getElementById('pagina-actual');
            const btnEditarInfoNegocio = document.getElementById('editar-info-negocio');
            const formEditarNegocio = document.getElementById('form-editar-negocio');
            const btnCancelarEdicion = document.getElementById('cancelar-edicion');
            const btnEliminarCuenta = document.getElementById('eliminar-cuenta');
            const btnGestionarInventario = document.getElementById('gestionar-inventario');
            const formInventario = document.getElementById('inventario-form');
            const inventarioTabla = document.getElementById('inventario-tabla');
            const btnVolverCatalogoInventario = document.getElementById('volver-catalogo-inventario');
            const btnVolverInventario = document.getElementById('volver-inventario');
            const movimientosTabla = document.getElementById('movimientos-tabla');
            const notificacionesContainer = document.getElementById('notificaciones');

            let paginaActualNum = 1;
            const productosPorPagina = 6;
            let cuponAplicado = null;

            function mostrarSeccion(seccion) {
                Object.values(secciones).forEach(s => s.classList.add('hidden'));
                seccion.classList.remove('hidden');
            }

            function mostrarNotificacion(mensaje, tipo = 'success') {
                const notificacion = document.createElement('div');
                notificacion.classList.add('notificacion');
                notificacion.classList.add(tipo === 'error' ? 'bg-red-500' : 'bg-green-500');
                notificacion.textContent = mensaje;
                notificacionesContainer.appendChild(notificacion);

                setTimeout(() => {
                    notificacion.remove();
                }, 5000);
            }

            document.getElementById('btn-mostrar-registro').addEventListener('click', () => mostrarSeccion(secciones.registro));
            document.getElementById('btn-mostrar-login').addEventListener('click', () => mostrarSeccion(secciones.login));

            formRegistro.addEventListener('submit', (e) => {
                e.preventDefault();
                const nombreNegocio = document.getElementById('reg-nombre-negocio').value;
                const telefono = document.getElementById('telefono').value;
                const direccion = document.getElementById('direccion').value;
                const pais = document.getElementById('pais').value;
                const contrasena = document.getElementById('reg-contrasena').value;
                const logo = document.getElementById('logo').files[0];

                localStorage.setItem('nombreNegocio', nombreNegocio);
                localStorage.setItem('telefono', telefono);
                localStorage.setItem('direccion', direccion);
                localStorage.setItem('pais', pais);
                localStorage.setItem('contrasena', contrasena);

                if (logo) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        localStorage.setItem('logo', e.target.result);
                    };
                    reader.readAsDataURL(logo);
                }

                mostrarNotificacion('Negocio registrado con éxito');
                mostrarSeccion(secciones.login);
            });

            formLogin.addEventListener('submit', (e) => {
                e.preventDefault();
                const nombreNegocio = document.getElementById('login-nombre-negocio').value;
                const contrasena = document.getElementById('login-contrasena').value;

                const storedNombre = localStorage.getItem('nombreNegocio');
                const storedContrasena = localStorage.getItem('contrasena');

                if (nombreNegocio === storedNombre && contrasena === storedContrasena) {
                    mostrarCatalogo();
                } else {
                    mostrarNotificacion('Credenciales incorrectas', 'error');
                }
            });

            function mostrarCatalogo() {
                mostrarSeccion(secciones.catalogo);
                actualizarInfoNegocio();
                mostrarProductos();
                cargarCategorias();
            }

            function actualizarInfoNegocio() {
                const nombreNegocio = localStorage.getItem('nombreNegocio');
                const telefono = localStorage.getItem('telefono');
                const direccion = localStorage.getItem('direccion');
                const pais = localStorage.getItem('pais');
                const logo = localStorage.getItem('logo');

                infoNegocio.innerHTML = `
                    <h3 class="text-xl font-semibold">${nombreNegocio}</h3>
                    <p>Teléfono: ${telefono}</p>
                    <p>Dirección: ${direccion}</p>
                    <p>País: ${pais}</p>
                `;

                if (logo) {
                    const img = document.createElement('img');
                    img.src = logo;
                    img.style.maxWidth = '100px';
                    img.classList.add('mb-2', 'rounded-full');
                    infoNegocio.prepend(img);
                }
            }

            btnAgregarProducto.addEventListener('click', () => {
                formProducto.reset();
                document.getElementById('producto-id').value = '';
                imagenesBotones.innerHTML = '';
                for (let i = 1; i <= 5; i++) {
                    const btn = document.createElement('button');
                    btn.textContent = `Imagen ${i}`;
                    btn.type = 'button';
                    btn.classList.add('btn-secondary', 'mb-2');
                    btn.innerHTML = `<i class="fas fa-image btn-icon"></i>Imagen ${i}`;
                    btn.addEventListener('click', () => cargarImagen(i));
                    imagenesBotones.appendChild(btn);
                }
                cargarCategorias();
                mostrarSeccion(secciones.formProducto);
            });

            btnCancelarProducto.addEventListener('click', () => {
                mostrarSeccion(secciones.catalogo);
            });

            function cargarImagen(index) {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.classList.add('imagen-producto', 'mb-2');
                        img.dataset.index = index;
                        const existingImg = imagenesBotones.querySelector(`img[data-index="${index}"]`);
                        if (existingImg) {
                            existingImg.replaceWith(img);
                        } else {
                            imagenesBotones.appendChild(img);
                        }
                    };
                    reader.readAsDataURL(file);
                };
                input.click();
            }

            formProducto.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = document.getElementById('producto-id').value || Date.now().toString();
                const nombre = document.getElementById('producto-nombre').value;
                const descripcion = document.getElementById('producto-descripcion').value;
                const precio = parseFloat(document.getElementById('producto-precio').value);
                const moneda = document.getElementById('producto-moneda').value;
                const categoria = document.getElementById('producto-categoria').value;
                const descuento = document.getElementById('producto-descuento').value;

                const imagenes = Array.from(imagenesBotones.querySelectorAll('img')).map(img => img.src);

                const producto = { id, nombre, descripcion, precio, moneda, categoria, descuento, imagenes };

                let productos = JSON.parse(localStorage.getItem('productos')) || [];
                const index = productos.findIndex(p => p.id === id);
                if (index !== -1) {
                    productos[index] = producto;
                } else {
                    productos.push(producto);
                }
                localStorage.setItem('productos', JSON.stringify(productos));

                mostrarNotificacion('Producto guardado con éxito');
                mostrarProductos();
                mostrarSeccion(secciones.catalogo);
            });

            function mostrarProductos() {
                const productos = JSON.parse(localStorage.getItem('productos')) || [];
                const inicio = (paginaActualNum - 1) * productosPorPagina;
                const fin = inicio + productosPorPagina;
                const productosPaginados = productos.slice(inicio, fin);

                productosContainer.innerHTML = '';
                for (const producto of productosPaginados) {
                    const precioOriginal = producto.precio;
                    let precioFinal = precioOriginal;
                    let descuentoTotal = parseFloat(producto.descuento) || 0;

                    if (cuponAplicado) {
                        descuentoTotal += parseFloat(cuponAplicado.descuento);
                    }

                    if (descuentoTotal > 0) {
                        precioFinal = precioOriginal * (1 - descuentoTotal / 100);
                    }

                    const productoElement = document.createElement('div');
                    productoElement.classList.add('producto', 'bg-white', 'rounded-lg', 'shadow-md', 'overflow-hidden');
                    productoElement.innerHTML = `
                        <div class="carrusel">
                            <div class="carrusel-inner">
                                ${producto.imagenes.map(src => `
                                    <div class="carrusel-item">
                                        <img src="${src}" alt="${producto.nombre}" class="imagen-producto">
                                    </div>
                                `).join('')}
                            </div>
                            ${producto.imagenes.length > 1 ? `
                                <button class="carrusel-control prev">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="carrusel-control next">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            ` : ''}
                        </div>
                        <div class="p-4">
                            <h3 class="text-xl font-semibold mb-2">${producto.nombre}</h3>
                            <p class="text-gray-600 mb-2">${producto.descripcion}</p>
                            <p class="mb-1">
                                <span class="${descuentoTotal > 0 ? 'line-through text-gray-500' : ''}">${precioOriginal.toFixed(2)} ${producto.moneda}</span>
                                ${descuentoTotal > 0 ? `<span class="ml-2 text-red-600 font-bold">${precioFinal.toFixed(2)} ${producto.moneda}</span>` : ''}
                            </p>
                            <p class="text-sm text-gray-500">Categoría: ${producto.categoria}</p>
                            ${descuentoTotal > 0 ? `<p class="text-sm text-red-600">Descuento: ${descuentoTotal}%</p>` : ''}
                            <div class="producto-acciones mt-4">
                                <button onclick="editarProducto('${producto.id}')" class="btn-secondary mr-2">
                                    <i class="fas fa-edit btn-icon"></i>Editar
                                </button>
                                <button onclick="eliminarProducto('${producto.id}')" class="btn-danger">
                                    <i class="fas fa-trash-alt btn-icon"></i>Eliminar
                                </button>
                            </div>
                        </div>
                    `;
                    productosContainer.appendChild(productoElement);

                    if (producto.imagenes.length > 1) {
                        const carrusel = productoElement.querySelector('.carrusel');
                        const inner = carrusel.querySelector('.carrusel-inner');
                        const prevBtn = carrusel.querySelector('.prev');
                        const nextBtn = carrusel.querySelector('.next');
                        let currentIndex = 0;

                        const updateCarrusel = () => {
                            inner.style.transform = `translateX(-${currentIndex * 100}%)`;
                            Array.from(inner.children).forEach((item, index) => {
                                item.style.opacity = index === currentIndex ? '1' : '0.5';
                            });
                        };

                        prevBtn.addEventListener('click', () => {
                            currentIndex = (currentIndex - 1 + producto.imagenes.length) % producto.imagenes.length;
                            updateCarrusel();
                        });

                        nextBtn.addEventListener('click', () => {
                            currentIndex = (currentIndex + 1) % producto.imagenes.length;
                            updateCarrusel();
                        });

                        updateCarrusel();
                    }
                }

                actualizarPaginacion();
            }

            function actualizarPaginacion() {
                const productos = JSON.parse(localStorage.getItem('productos')) || [];
                const totalPaginas = Math.ceil(productos.length / productosPorPagina);

                btnAnterior.disabled = paginaActualNum === 1;
                btnSiguiente.disabled = paginaActualNum === totalPaginas;

                paginaActual.textContent = `Página ${paginaActualNum} de ${totalPaginas}`;
            }

            btnAnterior.addEventListener('click', () => {
                if (paginaActualNum > 1) {
                    paginaActualNum--;
                    mostrarProductos();
                }
            });

            btnSiguiente.addEventListener('click', () => {
                const productos = JSON.parse(localStorage.getItem('productos')) || [];
                const totalPaginas = Math.ceil(productos.length / productosPorPagina);
                if (paginaActualNum < totalPaginas) {
                    paginaActualNum++;
                    mostrarProductos();
                }
            });

            window.editarProducto = (id) => {
                const productos = JSON.parse(localStorage.getItem('productos')) || [];
                const producto = productos.find(p => p.id === id);
                if (producto) {
                    document.getElementById('producto-id').value = producto.id;
                    document.getElementById('producto-nombre').value = producto.nombre;
                    document.getElementById('producto-descripcion').value = producto.descripcion;
                    document.getElementById('producto-precio').value = producto.precio;
                    document.getElementById('producto-moneda').value = producto.moneda;
                    document.getElementById('producto-categoria').value = producto.categoria;
                    document.getElementById('producto-descuento').value = producto.descuento;

                    imagenesBotones.innerHTML = '';
                    producto.imagenes.forEach((src, index) => {
                        const img = document.createElement('img');
                        img.src = src;
                        img.classList.add('imagen-producto', 'mb-2');
                        img.dataset.index = index + 1;
                        imagenesBotones.appendChild(img);
                    });

                    for (let i = producto.imagenes.length + 1; i <= 5; i++) {
                        const btn = document.createElement('button');
                        btn.textContent = `Imagen ${i}`;
                        btn.type = 'button';
                        btn.classList.add('btn-secondary', 'mb-2');
                        btn.innerHTML = `<i class="fas fa-image btn-icon"></i>Imagen ${i}`;
                        btn.addEventListener('click', () => cargarImagen(i));
                        imagenesBotones.appendChild(btn);
                    }

                    cargarCategorias();
                    mostrarSeccion(secciones.formProducto);
                }
            };

            window.eliminarProducto = (id) => {
                if (confirm('¿Estás seguro de que quieres eliminar este producto?')) {
                    let productos = JSON.parse(localStorage.getItem('productos')) || [];
                    productos = productos.filter(p => p.id !== id);
                    localStorage.setItem('productos', JSON.stringify(productos));
                    mostrarProductos();
                    mostrarNotificacion('Producto eliminado con éxito');
                }
            };

            btnCerrarSesion.addEventListener('click', () => {
                mostrarSeccion(secciones.inicio);
                mostrarNotificacion('Sesión cerrada');
            });

            function cargarCategorias() {
                const categorias = JSON.parse(localStorage.getItem('categorias')) || [];
                selectCategoria.innerHTML = '';
                categorias.forEach(categoria => {
                    const option = document.createElement('option');
                    option.value = categoria;
                    option.textContent = categoria;
                    selectCategoria.appendChild(option);
                });
            }

            btnGestionarCategorias.addEventListener('click', () => {
                mostrarSeccion(secciones.categorias);
                mostrarCategorias();
            });

            formCategoria.addEventListener('submit', (e) => {
                e.preventDefault();
                const nombreCategoria = document.getElementById('categoria-nombre').value;
                let categorias = JSON.parse(localStorage.getItem('categorias')) || [];
                if (!categorias.includes(nombreCategoria)) {
                    categorias.push(nombreCategoria);
                    localStorage.setItem('categorias', JSON.stringify(categorias));
                    mostrarCategorias();
                    document.getElementById('categoria-nombre').value = '';
                    mostrarNotificacion('Categoría agregada con éxito');
                } else {
                    mostrarNotificacion('Esta categoría ya existe', 'error');
                }
            });

            function mostrarCategorias() {
                const categorias = JSON.parse(localStorage.getItem('categorias')) || [];
                categoriasLista.innerHTML = '';
                categorias.forEach(categoria => {
                    const li = document.createElement('li');
                    li.classList.add('flex', 'justify-between', 'items-center', 'py-2', 'border-b');
                    li.innerHTML = `
                        <span>${categoria}</span>
                        <button onclick="eliminarCategoria('${categoria}')" class="btn-danger">
                            <i class="fas fa-trash-alt btn-icon"></i>Eliminar
                        </button>
                    `;
                    categoriasLista.appendChild(li);
                });
            }

            window.eliminarCategoria = (categoria) => {
                if (confirm(`¿Estás seguro de que quieres eliminar la categoría "${categoria}"?`)) {
                    let categorias = JSON.parse(localStorage.getItem('categorias')) || [];
                    categorias = categorias.filter(c => c !== categoria);
                    localStorage.setItem('categorias', JSON.stringify(categorias));
                    mostrarCategorias();
                    mostrarNotificacion('Categoría eliminada con éxito');
                }
            };

            btnVolverCatalogo.addEventListener('click', () => {
                mostrarSeccion(secciones.catalogo);
            });

            btnGestionarCupones.addEventListener('click', () => {
                mostrarSeccion(secciones.cupones);
                mostrarCupones();
            });

            formCupon.addEventListener('submit', (e) => {
                e.preventDefault();
                const codigoCupon = document.getElementById('cupon-codigo').value;
                const descuentoCupon = document.getElementById('cupon-descuento').value;
                let cupones = JSON.parse(localStorage.getItem('cupones')) || [];
                if (!cupones.some(c => c.codigo === codigoCupon)) {
                    cupones.push({ codigo: codigoCupon, descuento: descuentoCupon });
                    localStorage.setItem('cupones', JSON.stringify(cupones));
                    mostrarCupones();
                    document.getElementById('cupon-codigo').value = '';
                    document.getElementById('cupon-descuento').value = '';
                    mostrarNotificacion('Cupón agregado con éxito');
                } else {
                    mostrarNotificacion('Este código de cupón ya existe', 'error');
                }
            });

            function mostrarCupones() {
                const cupones = JSON.parse(localStorage.getItem('cupones')) || [];
                cuponesLista.innerHTML = '';
                cupones.forEach(cupon => {
                    const li = document.createElement('li');
                    li.classList.add('flex', 'justify-between', 'items-center', 'py-2', 'border-b');
                    li.innerHTML = `
                        <span>${cupon.codigo} - ${cupon.descuento}% de descuento</span>
                        <button onclick="eliminarCupon('${cupon.codigo}')" class="btn-danger">
                            <i class="fas fa-trash-alt btn-icon"></i>Eliminar
                        </button>
                    `;
                    cuponesLista.appendChild(li);
                });
            }

            window.eliminarCupon = (codigo) => {
                if (confirm(`¿Estás seguro de que quieres eliminar el cupón "${codigo}"?`)) {
                    let cupones = JSON.parse(localStorage.getItem('cupones')) || [];
                    cupones = cupones.filter(c => c.codigo !== codigo);
                    localStorage.setItem('cupones', JSON.stringify(cupones));
                    mostrarCupones();
                    
                    // Eliminar el descuento aplicado si el cupón eliminado era el que estaba en uso
                    if (cuponAplicado && cuponAplicado.codigo === codigo) {
                        cuponAplicado = null;
                        mostrarProductos(); // Actualizar los precios de los productos
                    }
                    mostrarNotificacion('Cupón eliminado con éxito');
                }
            };

            btnVolverCatalogoCupones.addEventListener('click', () => {
                mostrarSeccion(secciones.catalogo);
            });

            btnToggleCatalogo.addEventListener('click', () => {
                const estaAbierto = btnToggleCatalogo.classList.contains('abierto');
                if (estaAbierto) {
                    btnToggleCatalogo.classList.remove('abierto');
                    btnToggleCatalogo.classList.add('cerrado');
                    btnToggleCatalogo.innerHTML = '<i class="fas fa-store-slash"></i>';
                    btnToggleCatalogo.title = 'Catálogo Cerrado';
                    mostrarNotificacion('Catálogo cerrado');
                } else {
                    btnToggleCatalogo.classList.remove('cerrado');
                    btnToggleCatalogo.classList.add('abierto');
                    btnToggleCatalogo.innerHTML = '<i class="fas fa-store"></i>';
                    btnToggleCatalogo.title = 'Catálogo Abierto';
                    mostrarNotificacion('Catálogo abierto');
                }
            });

            btnAplicarCupon.addEventListener('click', () => {
                const codigoCupon = cuponInput.value;
                const cupones = JSON.parse(localStorage.getItem('cupones')) || [];
                const cupon = cupones.find(c => c.codigo === codigoCupon);
                if (cupon) {
                    cuponAplicado = cupon;
                    mostrarNotificacion(`Cupón aplicado: ${cupon.descuento}% de descuento`);
                    mostrarProductos();
                } else {
                    mostrarNotificacion('Cupón no válido', 'error');
                }
            });

            btnEditarInfoNegocio.addEventListener('click', () => {
                const nombreNegocio = localStorage.getItem('nombreNegocio');
                const telefono = localStorage.getItem('telefono');
                const direccion = localStorage.getItem('direccion');
                const pais = localStorage.getItem('pais');

                document.getElementById('edit-nombre-negocio').value = nombreNegocio;
                document.getElementById('edit-telefono').value = telefono;
                document.getElementById('edit-direccion').value = direccion;
                document.getElementById('edit-pais').value = pais;

                mostrarSeccion(secciones.editarNegocio);
            });

            formEditarNegocio.addEventListener('submit', (e) => {
                e.preventDefault();
                const nombreNegocio = document.getElementById('edit-nombre-negocio').value;
                const telefono = document.getElementById('edit-telefono').value;
                const direccion = document.getElementById('edit-direccion').value;
                const pais = document.getElementById('edit-pais').value;
                const logo = document.getElementById('edit-logo').files[0];

                localStorage.setItem('nombreNegocio', nombreNegocio);
                localStorage.setItem('telefono', telefono);
                localStorage.setItem('direccion', direccion);
                localStorage.setItem('pais', pais);

                if (logo) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        localStorage.setItem('logo', e.target.result);
                    };
                    reader.readAsDataURL(logo);
                }

                mostrarNotificacion('Información del negocio actualizada con éxito');
                mostrarCatalogo();
            });

            btnCancelarEdicion.addEventListener('click', () => {
                mostrarSeccion(secciones.catalogo);
            });

            btnEliminarCuenta.addEventListener('click', () => {
                if (confirm('¿Estás seguro de que quieres eliminar tu cuenta? Esta acción no se puede deshacer.')) {
                    // Eliminar todos los datos del localStorage
                    localStorage.clear();
                    mostrarNotificacion('Tu cuenta ha sido eliminada. Serás redirigido a la página de inicio.');
                    mostrarSeccion(secciones.inicio);
                }
            });

            btnGestionarInventario.addEventListener('click', () => {
                mostrarSeccion(secciones.inventario);
                mostrarInventario();
            });

            formInventario.addEventListener('submit', (e) => {
                e.preventDefault();
                const nombre = document.getElementById('inventario-nombre').value;
                const cantidadEntrada = parseInt(document.getElementById('inventario-cantidad-entrada').value) || 0;
                const cantidadSalida = parseInt(document.getElementById('inventario-cantidad-salida').value) || 0;
                const precioInversion = parseFloat(document.getElementById('inventario-precio-inversion').value);
                const precioVenta = parseFloat(document.getElementById('inventario-precio-venta').value);

                let inventario = JSON.parse(localStorage.getItem('inventario')) || [];
                let item = inventario.find(i => i.nombre === nombre);

                if (item) {
                    item.total += cantidadEntrada - cantidadSalida;
                    item.precioInversion = precioInversion;
                    item.precioVenta = precioVenta;
                } else {
                    item = {
                        nombre,
                        total: cantidadEntrada - cantidadSalida,
                        precioInversion,
                        precioVenta,
                        movimientos: []
                    };
                    inventario.push(item);
                }

                const fecha = new Date().toLocaleString('es-ES', { timeZone: 'America/Havana' });

                if (cantidadEntrada > 0) {
                    item.movimientos.push({
                        fecha,
                        tipo: 'Entrada',
                        cantidad: cantidadEntrada
                    });
                }

                if (cantidadSalida > 0) {
                    item.movimientos.push({
                        fecha,
                        tipo: 'Salida',
                        cantidad: cantidadSalida
                    });
                }

                localStorage.setItem('inventario', JSON.stringify(inventario));
                mostrarInventario();
                formInventario.reset();
                mostrarNotificacion('Producto de inventario actualizado con éxito');
            });

            function mostrarInventario() {
                const inventario = JSON.parse(localStorage.getItem('inventario')) || [];
                const tbody = inventarioTabla.querySelector('tbody');
                tbody.innerHTML = '';

                let inversionTotal = 0;
                let ventaTotal = 0;

                inventario.forEach(item => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${item.nombre}</td>
                        <td>${item.total}</td>
                        <td>${item.precioInversion.toFixed(2)}</td>
                        <td>${item.precioVenta.toFixed(2)}</td>
                        <td>
                            <button onclick="editarInventario('${item.nombre}')" class="btn-secondary mr-2">
                                <i class="fas fa-edit btn-icon"></i>Editar
                            </button>
                            <button onclick="eliminarInventario('${item.nombre}')" class="btn-danger mr-2">
                                <i class="fas fa-trash-alt btn-icon"></i>Eliminar
                            </button>
                            <button onclick="verMovimientos('${item.nombre}')" class="btn-primary">
                                <i class="fas fa-history btn-icon"></i>Movimientos
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);

                    inversionTotal += item.precioInversion * item.total;
                    ventaTotal += item.precioVenta * item.total;
                });

                const gananciaTotal = ventaTotal - inversionTotal;

                document.getElementById('inversion-total').textContent = inversionTotal.toFixed(2);
                document.getElementById('venta-total').textContent = ventaTotal.toFixed(2);
                document.getElementById('ganancia-total').textContent = gananciaTotal.toFixed(2);
            }

            window.editarInventario = (nombre) => {
                const inventario = JSON.parse(localStorage.getItem('inventario')) || [];
                const item = inventario.find(i => i.nombre === nombre);
                if (item) {
                    document.getElementById('inventario-nombre').value = item.nombre;
                    document.getElementById('inventario-cantidad-entrada').value = '';
                    document.getElementById('inventario-cantidad-salida').value = '';
                    document.getElementById('inventario-precio-inversion').value = item.precioInversion;
                    document.getElementById('inventario-precio-venta').value = item.precioVenta;
                }
            };

            window.eliminarInventario = (nombre) => {
                if (confirm(`¿Estás seguro de que quieres eliminar "${nombre}" del inventario?`)) {
                    let inventario = JSON.parse(localStorage.getItem('inventario')) || [];
                    inventario = inventario.filter(item => item.nombre !== nombre);
                    localStorage.setItem('inventario', JSON.stringify(inventario));
                    mostrarInventario();
                    mostrarNotificacion('Producto de inventario eliminado con éxito');
                }
            };

            window.verMovimientos = (nombre) => {
                const inventario = JSON.parse(localStorage.getItem('inventario')) || [];
                const item = inventario.find(i => i.nombre === nombre);
                if (item) {
                    const tbody = movimientosTabla.querySelector('tbody');
                    tbody.innerHTML = '';
                    item.movimientos.forEach(movimiento => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${movimiento.fecha}</td>
                            <td>${item.nombre}</td>
                            <td>${movimiento.tipo}</td>
                            <td>${movimiento.cantidad}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                    mostrarSeccion(secciones.registroMovimientos);
                }
            };

            btnVolverCatalogoInventario.addEventListener('click', () => {
                mostrarSeccion(secciones.catalogo);
            });

            btnVolverInventario.addEventListener('click', () => {
                mostrarSeccion(secciones.inventario);
            });

            if (localStorage.getItem('nombreNegocio')) {
                mostrarCatalogo();
            }
        });
    </script>
</body>
</html>
